# 股票交易模拟系统 API 应用手册

## 系统概述

本系统是一个完整的股票交易模拟平台，包含后端 API 服务、前端交易界面和控制面板。系统模拟了真实股票交易环境，支持实时股票数据获取、交易下单、持仓管理等功能。

---

## 主要功能模块

- **交易引擎**：处理股票买卖、订单管理和持仓计算
- **数据爬虫**：从东方财富获取实时股票数据
- **前端界面**：提供用户交互界面
- **控制面板**：管理系统运行状态
- **API 服务**：提供 RESTful 接口供前端调用

---

## API 接口文档

### 1. 获取投资组合信息

- **URL**：`/api/portfolio`
- **方法**：GET
- **功能**：获取当前用户的投资组合信息

**响应示例：**

```json
{
    "cash": 98500.00,
    "frozen_cash": 0.00,
    "positions": {
        "sh600519": {
            "quantity": 100,
            "avg_cost": 1700.00,
            "current_price": 1750.00,
            "market_value": 175000.00,
            "profit": 5000.00,
            "buy_date": "2023-05-15"
        }
    },
    "total_assets": 273500.00,
    "stock_value": 175000.00,
    "total_profit": 73500.00,
    "today_profit": 2500.00
}
```

---

### 2. 获取股票数据

- **URL**：`/api/stock/<stock_code>`
- **方法**：GET
- **参数**：
    - `stock_code`：股票代码（如 sh600519）
- **功能**：获取指定股票的实时数据

**响应示例：**

```json
{
    "code": "sh600519",
    "name": "贵州茅台",
    "current": 1750.00,
    "open": 1745.00,
    "prev_close": 1700.00,
    "high": 1760.00,
    "low": 1740.00,
    "volume": 100000,
    "amount": 175000000.00,
    "bid1": 1749.50,
    "bid1_vol": 500,
    "ask1": 1750.50,
    "ask1_vol": 300,
    "timestamp": "2023-08-12 10:30:45"
}
```

---

### 3. 买入股票

- **URL**：`/api/buy`
- **方法**：POST
- **请求体**：

```json
{
    "stock": "sh600519",
    "price": 1750.00,
    "quantity": 100
}
```

- **功能**：执行股票买入操作

**响应示例：**

```json
{
    "success": true,
    "message": "买入成功，成交价: ¥1750.00"
}
```

---

### 4. 卖出股票

- **URL**：`/api/sell`
- **方法**：POST
- **请求体**：

```json
{
    "stock": "sh600519",
    "price": 1750.00,
    "quantity": 100
}
```

- **功能**：执行股票卖出操作

**响应示例：**

```json
{
    "success": true,
    "message": "卖出成功，成交价: ¥1750.00"
}
```

---

### 5. 取消订单

- **URL**：`/api/cancel_order`
- **方法**：POST
- **请求体**：

```json
{
    "order_id": "d3b07384-d113-11ec-9d64-0242ac120002"
}
```

- **功能**：取消指定订单

**响应示例：**

```json
{
    "success": true,
    "message": "撤单成功"
}
```

---

### 6. 获取所有订单

- **URL**：`/api/orders`
- **方法**：GET
- **功能**：获取当前用户的所有订单

**响应示例：**

```json
[
    {
        "order_id": "d3b07384-d113-11ec-9d64-0242ac120002",
        "type": "买入",
        "stock": "sh600519",
        "price": 1750.00,
        "quantity": 100,
        "status": "pending",
        "created_at": "2023-08-12 10:25:30"
    }
]
```

---

### 7. 获取交易历史

- **URL**：`/api/history`
- **方法**：GET
- **功能**：获取用户的交易历史记录

**响应示例：**

```json
[
    {
        "type": "买入",
        "stock": "sh600519",
        "price": 1700.00,
        "quantity": 100,
        "amount": 170000.00,
        "datetime": "2023-08-10 14:30:22",
        "profit": 0.00
    }
]
```

---

### 8. 获取当前交易阶段

- **URL**：`/api/trading_phase`
- **方法**：GET
- **功能**：获取当前交易时段

**响应示例：**

```json
{
    "phase": "continuous_am"
}
```

---

### 9. 获取资金曲线历史

- **URL**：`/api/equity_history`
- **方法**：GET
- **功能**：获取资金变化历史

**响应示例：**

```json
[
    {
        "timestamp": "2023-08-12 10:00:00",
        "total_assets": 100000.00,
        "cash": 100000.00,
        "stock_value": 0.00
    }
]
```

---

## 系统使用说明

### 启动系统

1. 运行 `app.pyw` 文件
2. 系统将启动控制面板窗口
3. 点击“打开浏览器”按钮访问交易界面

---

### 交易界面功能

- **股票查询**：输入股票代码或点击示例股票按钮
- **交易操作**：
    - 输入价格和数量（手数）
    - 点击“买入”或“卖出”按钮执行交易
- **持仓查看**：
    - 查看当前持仓股票
    - 查看持仓收益情况
- **订单管理**：
    - 查看所有订单状态
    - 取消未成交订单
- **历史记录**：
    - 查看历史交易记录
    - 按时间、股票筛选记录

---

### 控制面板功能

- 显示服务器状态信息
- 打开浏览器访问交易界面
- 安全关闭整个系统

---

## 交易规则

- **T+1 交易**：当日买入的股票下一交易日才能卖出
- **交易时间**：
    - 早盘：9:30-11:30
    - 午盘：13:00-15:00
    - 集合竞价：9:15-9:25
- **交易费用**：
    - 买入：佣金（万2.5，最低5元）+ 过户费（万0.1）
    - 卖出：佣金（万2.5）+ 印花税（千1）+ 过户费（万0.1）

---

## 注意事项

- 系统使用模拟数据，非真实交易
- 股票价格数据来自东方财富网
- 系统状态自动保存到 `data/trading.pkl` 文件
- 关闭控制面板将终止整个系统

---

## 系统依赖

- Python 3.7+
- Flask
- Flask-CORS
- requests
- holidays
- tkinter
